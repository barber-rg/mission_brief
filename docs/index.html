<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Brief Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .print-only {
            display: none;
        }

        .editor {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            min-height: 8rem;
            padding: 0.5rem;
            outline: none;
        }
        .editor:focus-within {
            box-shadow: 0 0 0 2px #3b82f6;
            border-color: #3b82f6;
        }
        .editor-toolbar button {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: #f3f4f6;
            font-weight: 600;
        }
        .editor-toolbar button:hover {
            background-color: #e5e7eb;
        }


        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
                color: #000;
            }

            #app-container { padding: 0; margin: 0; }
            #brief-form { box-shadow: none; border: none; padding: 0; }
            section { page-break-inside: avoid; }
            h3 { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; font-size: 1.25rem; }
            h4 { font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem; }
            .print-text { white-space: pre-wrap; word-wrap: break-word; padding-top: 0.5rem; }
            .print-list { list-style-type: disc; padding-left: 1.5rem; padding-top: 0.5rem; }
            .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app-container" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <div class="text-center mb-4 no-print">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Mission Brief Generator</h1>
            <p class="text-gray-600 mt-2">Upload an SOW to pre-fill the form, or fill it out manually.</p>
        </div>

        <!-- New SOW Upload Section -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-8 no-print">
            <h3 class="font-semibold text-lg text-gray-800 mb-3">Automate with AI</h3>
            <div class="flex flex-wrap items-center gap-4">
                <input type="file" id="sow-uploader" class="flex-grow p-2 border border-gray-300 rounded-md" accept=".pdf,.docx">
                <button onclick="processSOW()" class="bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700">Analyze SOW & Pre-fill Form</button>
            </div>
            <div id="loading-indicator" class="hidden mt-4 text-center">
                <p class="text-gray-600">Analyzing document, please wait...</p>
            </div>
        </div>

        <!-- Load Project Section -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-8 flex flex-wrap items-center gap-4 no-print">
            <label for="project-loader-dropdown" class="font-medium text-gray-700 whitespace-nowrap">Load Saved Project:</label>
            <select id="project-loader-dropdown" onchange="loadSelectedProject(this.value)" class="flex-grow p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                <option value="">-- Select a Project --</option>
            </select>
            <button type="button" onclick="document.getElementById('file-loader').click()" class="text-sm text-blue-600 hover:underline whitespace-nowrap">or Load from File...</button>
            <input type="file" id="file-loader" class="hidden" accept=".json" onchange="handleFileSelect(event)">
        </div>


        <!-- Main Form Container -->
        <div id="brief-form" class="bg-white rounded-xl shadow-lg p-6 sm:p-8">
            <header class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-2xl font-bold text-blue-700">Mission Brief</h2>
                <span class="text-sm font-medium text-gray-500 no-print">Version: <span id="version-display">1</span></span>
            </header>
            <input type="hidden" id="version-counter" value="1">

            <form id="mission-brief-form">
                <!-- Project Details Section -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="md:col-span-2">
                        <div class="no-print">
                            <label for="project-name" class="block text-sm font-medium text-gray-700 mb-1">Project Name</label>
                            <input type="text" id="project-name" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="print-only"><h4>Project Name</h4><p id="print-project-name"></p></div>
                    </div>
                    <div>
                        <div class="no-print">
                            <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">Client</label>
                            <input type="text" id="client-name" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="print-only"><h4>Client</h4><p id="print-client-name"></p></div>
                    </div>
                    <div>
                        <div class="no-print">
                            <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="date" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="print-only"><h4>Date</h4><p id="print-date"></p></div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="no-print">
                            <label for="project-status" class="block text-sm font-medium text-gray-700 mb-1">Project Status</label>
                            <select id="project-status" class="w-full p-2 border border-gray-300 rounded-md">
                                <option>Draft</option>
                                <option>In Review</option>
                                <option>Approved</option>
                                <option>Archived</option>
                            </select>
                        </div>
                        <div class="print-only"><h4>Status</h4><p id="print-project-status"></p></div>
                    </div>
                </div>

                <!-- Section Template -->
                <div class="space-y-8">
                    <!-- 1. Mission Objective -->
                    <section>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">1. Mission Objective</h3>
                        <div class="no-print">
                            <div class="editor-toolbar mb-2 space-x-2"><button type="button" onmousedown="event.preventDefault(); formatDoc('bold', 'mission-objective')">B</button><button type="button" onmousedown="event.preventDefault(); formatDoc('italic', 'mission-objective')">I</button><button type="button" onmousedown="event.preventDefault(); formatDoc('insertUnorderedList', 'mission-objective')">List</button></div>
                            <div id="mission-objective" class="editor" contenteditable="true"></div>
                        </div>
                        <div id="print-mission-objective" class="print-only print-text"></div>
                    </section>

                    <!-- 2. Background & Situation -->
                    <section>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">2. Background & Situation</h3>
                        <div class="no-print">
                           <div class="editor-toolbar mb-2 space-x-2"><button type="button" onmousedown="event.preventDefault(); formatDoc('bold', 'background')">B</button><button type="button" onmousedown="event.preventDefault(); formatDoc('italic', 'background')">I</button><button type="button" onmousedown="event.preventDefault(); formatDoc('insertUnorderedList', 'background')">List</button></div>
                           <div id="background" class="editor" contenteditable="true"></div>
                        </div>
                        <div id="print-background" class="print-only print-text"></div>
                    </section>

                    <!-- 3. Key Deliverables -->
                    <section>
                        <div class="flex justify-between items-center mb-3 border-b pb-2">
                            <h3 class="text-xl font-semibold text-gray-800">3. Key Deliverables</h3>
                            <button type="button" onclick="addItem('deliverables-list')" class="no-print bg-blue-100 text-blue-700 text-sm font-medium px-3 py-1 rounded-md">Add Item</button>
                        </div>
                        <div id="deliverables-list" class="space-y-2 no-print">
                            <div class="flex items-center gap-2"><input type="text" class="w-full p-2 border border-gray-300 rounded-md" placeholder="e.g., Comprehensive market analysis report"><button type="button" onclick="this.parentElement.remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md">X</button></div>
                        </div>
                        <ul id="print-deliverables-list" class="print-only print-list"></ul>
                    </section>

                    <!-- 4. Scope of Work -->
                    <section>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">4. Scope of Work</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 no-print">
                            <div>
                                <h4 class="font-medium text-gray-700 mb-2">In Scope</h4>
                                <div class="editor-toolbar mb-2 space-x-2"><button type="button" onmousedown="event.preventDefault(); formatDoc('bold', 'in-scope')">B</button><button type="button" onmousedown="event.preventDefault(); formatDoc('italic', 'in-scope')">I</button><button type="button" onmousedown="event.preventDefault(); formatDoc('insertUnorderedList', 'in-scope')">List</button></div>
                                <div id="in-scope" class="editor" contenteditable="true"></div>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-700 mb-2">Out of Scope</h4>
                                <div class="editor-toolbar mb-2 space-x-2"><button type="button" onmousedown="event.preventDefault(); formatDoc('bold', 'out-of-scope')">B</button><button type="button" onmousedown="event.preventDefault(); formatDoc('italic', 'out-of-scope')">I</button><button type="button" onmousedown="event.preventDefault(); formatDoc('insertUnorderedList', 'out-of-scope')">List</button></div>
                                <div id="out-of-scope" class="editor" contenteditable="true"></div>
                            </div>
                        </div>
                        <div class="print-only print-grid">
                             <div><h4>In Scope</h4><div id="print-in-scope" class="print-text"></div></div>
                             <div><h4>Out of Scope</h4><div id="print-out-of-scope" class="print-text"></div></div>
                        </div>
                    </section>

                    <!-- 5. Team & Roles -->
                    <section>
                        <div class="flex justify-between items-center mb-3 border-b pb-2">
                            <h3 class="text-xl font-semibold text-gray-800">5. Team & Roles</h3>
                            <button type="button" onclick="addItem('team-list', true)" class="no-print bg-blue-100 text-blue-700 text-sm font-medium px-3 py-1 rounded-md">Add Role</button>
                        </div>
                        <div id="team-list" class="space-y-3 no-print">
                            <div class="flex items-center gap-2"><input type="text" class="w-1/3 p-2 border border-gray-300 rounded-md" placeholder="Role (e.g., Project Lead)"><input type="text" class="w-2/3 p-2 border border-gray-300 rounded-md" placeholder="Name"><button type="button" onclick="this.parentElement.remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md">X</button></div>
                        </div>
                        <ul id="print-team-list" class="print-only print-list"></ul>
                    </section>

                    <!-- 6. Project Resources & Data Management -->
                    <section>
                        <h3 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">6. Project Resources & Data Management</h3>
                        <div class="no-print">
                            <label for="repo-link" class="block text-sm font-medium text-gray-700 mb-1">Central Repository Link</label>
                            <input type="url" id="repo-link" class="w-full p-2 border border-gray-300 rounded-md" placeholder="https://drive.google.com/...">
                        </div>
                        <p id="print-repo-link" class="print-only print-text"></p>
                    </section>
                    
                    <!-- 7. High-Level Timeline & Milestones -->
                    <section>
                        <div class="flex justify-between items-center mb-3 border-b pb-2">
                            <h3 class="text-xl font-semibold text-gray-800">7. High-Level Timeline & Milestones</h3>
                            <button type="button" onclick="addMilestone()" class="no-print bg-blue-100 text-blue-700 text-sm font-medium px-3 py-1 rounded-md">Add Milestone</button>
                        </div>
                        <div id="milestones-list" class="space-y-4 no-print"></div>
                        <ul id="print-milestones-list" class="print-only print-list"></ul>
                    </section>

                    <!-- 8. Success Metrics -->
                    <section>
                        <div class="flex justify-between items-center mb-3 border-b pb-2">
                             <h3 class="text-xl font-semibold text-gray-800">8. Success Metrics</h3>
                             <button type="button" onclick="addItem('metrics-list')" class="no-print bg-blue-100 text-blue-700 text-sm font-medium px-3 py-1 rounded-md">Add Metric</button>
                        </div>
                        <div id="metrics-list" class="space-y-2 no-print">
                           <div class="flex items-center gap-2"><input type="text" class="w-full p-2 border border-gray-300 rounded-md" placeholder="e.g., 25% increase in qualified leads"><button type="button" onclick="this.parentElement.remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md">X</button></div>
                        </div>
                        <ul id="print-metrics-list" class="print-only print-list"></ul>
                    </section>
                </div>
            </form>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex flex-wrap justify-center gap-4 no-print">
             <button onclick="resetForm()" class="bg-gray-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-all shadow-md">
                Reset Form
            </button>
            <button onclick="saveProgress()" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all shadow-md">
                Save Progress
            </button>
            <button onclick="window.print()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all shadow-md">
                Print Mission Brief
            </button>
        </div>
    </div>

    <script>
        const PROJECT_DB_PREFIX = 'mission-brief-';
        let lastSelection = {};

        // --- Rich Text Editor Functions ---
        function saveSelection(containerEl) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                lastSelection[containerEl.id] = selection.getRangeAt(0);
            }
        }

        function restoreSelection(containerEl) {
            const selection = window.getSelection();
            const savedRange = lastSelection[containerEl.id];
            if (savedRange) {
                selection.removeAllRanges();
                selection.addRange(savedRange);
            }
        }
        
        function formatDoc(command, editorId) {
            const editor = document.getElementById(editorId);
            editor.focus();
            restoreSelection(editor);
            document.execCommand(command, false, null);
        }

        // --- Dynamic Item Functions ---
        function addItem(listId, isTeamRole = false, data = null) {
            const list = document.getElementById(listId);
            if (!list) return;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'flex items-center gap-2';
            if (isTeamRole) {
                const role = data ? data.role : '';
                const name = data ? data.name : '';
                itemDiv.innerHTML = `<input type="text" class="w-1/3 p-2 border border-gray-300 rounded-md" placeholder="Role" value="${role}"><input type="text" class="w-2/3 p-2 border border-gray-300 rounded-md" placeholder="Name" value="${name}"><button type="button" onclick="this.parentElement.remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md">X</button>`;
            } else {
                const value = data || '';
                itemDiv.innerHTML = `<input type="text" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Enter another item..." value="${value}"><button type="button" onclick="this.parentElement.remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md">X</button>`;
            }
            list.appendChild(itemDiv);
        }

        function addMilestone(name = '', startDate = '', endDate = '') {
            const list = document.getElementById('milestones-list');
            if (!list) return;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'milestone-item grid grid-cols-1 sm:grid-cols-12 gap-2 items-center';
            itemDiv.innerHTML = `
                <input type="text" class="sm:col-span-6 w-full p-2 border border-gray-300 rounded-md" placeholder="Milestone Name" value="${name}">
                <input type="date" class="sm:col-span-2 w-full p-2 border border-gray-300 rounded-md" title="Start Date" value="${startDate}">
                <input type="date" class="sm:col-span-2 w-full p-2 border border-gray-300 rounded-md" title="End Date" value="${endDate}">
                <div class="sm:col-span-2 flex justify-end">
                     <button type="button" onclick="this.closest('.milestone-item').remove()" class="no-print remove-button bg-red-100 text-red-700 p-2 rounded-md w-full sm:w-auto">X</button>
                </div>
            `;
            list.appendChild(itemDiv);
        }

        // --- SOW Processing ---
        function processSOW() {
            const uploader = document.getElementById('sow-uploader');
            const loadingIndicator = document.getElementById('loading-indicator');

            if (uploader.files.length === 0) {
                alert('Please select a file to analyze.');
                return;
            }
            
            loadingIndicator.classList.remove('hidden');

            // ** THIS IS A PLACEHOLDER **
            // In a real application, you would send the file to your backend server here.
            // The server would process it with the Gemini API and send back structured data.
            setTimeout(() => {
                // Simulate receiving data from the backend
                const dummyData = {
                    version: 1,
                    projectName: 'AI-Extracted Project Name',
                    clientName: 'AI-Extracted Client Name',
                    date: new Date().toISOString().split('T')[0],
                    projectStatus: 'Draft',
                    missionObjective: 'This is the mission objective extracted by the AI.',
                    background: 'This is the background and situation extracted by the AI.',
                    inScope: '<ul><li>In-scope item 1 from SOW</li><li>In-scope item 2 from SOW</li></ul>',
                    outOfScope: '<ul><li>Out-of-scope item 1 from SOW</li></ul>',
                    repoLink: '',
                    deliverables: ['Deliverable A from SOW', 'Deliverable B from SOW'],
                    team: [{role: 'Extracted Role', name: 'Extracted Name'}],
                    milestones: [{name: 'Extracted Milestone', start: '', end: ''}],
                    metrics: ['Metric A from SOW']
                };

                populateForm(dummyData);
                loadingIndicator.classList.add('hidden');
                alert('SOW analysis complete! The form has been pre-filled.');

            }, 3000); // Simulate a 3-second processing time
        }

        // --- Save/Load Progress Functions ---
        function getFormData() {
            const data = {
                version: parseInt(document.getElementById('version-counter').value),
                projectName: document.getElementById('project-name').value.trim(),
                clientName: document.getElementById('client-name').value,
                date: document.getElementById('date').value,
                projectStatus: document.getElementById('project-status').value,
                missionObjective: document.getElementById('mission-objective').innerHTML,
                background: document.getElementById('background').innerHTML,
                inScope: document.getElementById('in-scope').innerHTML,
                outOfScope: document.getElementById('out-of-scope').innerHTML,
                repoLink: document.getElementById('repo-link').value,
                deliverables: [], team: [], milestones: [], metrics: []
            };
            document.querySelectorAll('#deliverables-list input[type="text"]').forEach(input => data.deliverables.push(input.value));
            document.querySelectorAll('#metrics-list input[type="text"]').forEach(input => data.metrics.push(input.value));
            document.querySelectorAll('#team-list .flex').forEach(item => {
                const inputs = item.querySelectorAll('input');
                data.team.push({ role: inputs[0].value, name: inputs[1].value });
            });
            document.querySelectorAll('#milestones-list .milestone-item').forEach(item => {
                const inputs = item.querySelectorAll('input');
                data.milestones.push({ name: inputs[0].value, start: inputs[1].value, end: inputs[2].value });
            });
            return data;
        }

        function saveProgress() {
            const versionCounter = document.getElementById('version-counter');
            versionCounter.value = parseInt(versionCounter.value) + 1;
            const data = getFormData();
            if (!data.projectName) {
                alert('Please enter a Project Name before saving.');
                return;
            }
            localStorage.setItem(PROJECT_DB_PREFIX + data.projectName, JSON.stringify(data));
            populateProjectDropdown();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.projectName} - Mission Brief Data - v${data.version}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert(`Project "${data.projectName}" (v${data.version}) saved successfully!`);
        }

        function handleFileSelect(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    populateForm(data);
                    if (data.projectName) {
                        localStorage.setItem(PROJECT_DB_PREFIX + data.projectName, JSON.stringify(data));
                        populateProjectDropdown();
                    }
                } catch (error) {
                    alert('Error: Could not parse the file.');
                }
            };
            reader.readAsText(event.target.files[0]);
            event.target.value = '';
        }

        function populateForm(data) {
            document.getElementById('version-counter').value = data.version || 1;
            document.getElementById('version-display').textContent = data.version || 1;
            document.getElementById('project-name').value = data.projectName || '';
            document.getElementById('client-name').value = data.clientName || '';
            document.getElementById('date').value = data.date || '';
            document.getElementById('project-status').value = data.projectStatus || 'Draft';
            document.getElementById('mission-objective').innerHTML = data.missionObjective || '';
            document.getElementById('background').innerHTML = data.background || '';
            document.getElementById('in-scope').innerHTML = data.inScope || '';
            document.getElementById('out-of-scope').innerHTML = data.outOfScope || '';
            document.getElementById('repo-link').value = data.repoLink || '';

            const clearAndFill = (listId, items, creatorFn) => {
                const list = document.getElementById(listId);
                list.innerHTML = '';
                if (items && items.length > 0) {
                    items.forEach(item => creatorFn(item));
                } else {
                     creatorFn(isListTeamOrMilestone(listId) ? {} : '');
                }
            };
            
            function isListTeamOrMilestone(listId) {
                return listId === 'team-list' || listId === 'milestones-list';
            }

            clearAndFill('deliverables-list', data.deliverables, (item) => addItem('deliverables-list', false, item));
            clearAndFill('metrics-list', data.metrics, (item) => addItem('metrics-list', false, item));
            clearAndFill('team-list', data.team, (item) => addItem('team-list', true, item));
            clearAndFill('milestones-list', data.milestones, (item) => addMilestone(item.name, item.start, item.end));
        }

        function populateProjectDropdown() {
            const dropdown = document.getElementById('project-loader-dropdown');
            const projects = Object.keys(localStorage).filter(key => key.startsWith(PROJECT_DB_PREFIX)).map(key => key.substring(PROJECT_DB_PREFIX.length));
            const selectedValue = dropdown.value;
            dropdown.innerHTML = '<option value="">-- Select a Project --</option>';
            if (projects.length > 0) {
                projects.sort().forEach(projectName => {
                    const option = document.createElement('option');
                    option.value = projectName;
                    option.textContent = projectName;
                    dropdown.appendChild(option);
                });
            }
            dropdown.value = selectedValue;
        }

        function loadSelectedProject(projectName) {
            if (!projectName) return;
            const data = JSON.parse(localStorage.getItem(PROJECT_DB_PREFIX + projectName));
            populateForm(data);
        }

        function prepareForPrint() {
            document.getElementById('print-project-name').textContent = document.getElementById('project-name').value;
            document.getElementById('print-client-name').textContent = document.getElementById('client-name').value;
            document.getElementById('print-date').textContent = document.getElementById('date').value;
            document.getElementById('print-project-status').textContent = document.getElementById('project-status').value;
            document.getElementById('print-mission-objective').innerHTML = document.getElementById('mission-objective').innerHTML;
            document.getElementById('print-background').innerHTML = document.getElementById('background').innerHTML;
            document.getElementById('print-in-scope').innerHTML = document.getElementById('in-scope').innerHTML;
            document.getElementById('print-out-of-scope').innerHTML = document.getElementById('out-of-scope').innerHTML;
            document.getElementById('print-repo-link').textContent = document.getElementById('repo-link').value;

            const createPrintList = (sourceListId, targetListId, formatter) => {
                const sourceList = document.getElementById(sourceListId);
                const targetList = document.getElementById(targetListId);
                targetList.innerHTML = '';
                if (formatter) {
                     const itemDivs = sourceList.querySelectorAll('.flex, .milestone-item');
                     itemDivs.forEach(div => {
                        const li = document.createElement('li');
                        li.textContent = formatter(div.querySelectorAll('input'));
                        targetList.appendChild(li);
                     });
                } else {
                    sourceList.querySelectorAll('input[type="text"]').forEach(item => {
                        if (item.value) {
                            const li = document.createElement('li');
                            li.textContent = item.value;
                            targetList.appendChild(li);
                        }
                    });
                }
            };

            createPrintList('deliverables-list', 'print-deliverables-list');
            createPrintList('metrics-list', 'print-metrics-list');
            createPrintList('team-list', 'print-team-list', (inputs) => `${inputs[0].value}: ${inputs[1].value}`);
            createPrintList('milestones-list', 'print-milestones-list', (inputs) => {
                let text = inputs[0].value;
                if (inputs[1].value || inputs[2].value) {
                    text += ` (${inputs[1].value || 'N/A'} - ${inputs[2].value || 'N/A'})`;
                }
                return text;
            });
        }
        
        function resetForm() {
            if (confirm("Are you sure you want to clear the form? Any unsaved progress will be lost.")) {
                document.getElementById('mission-brief-form').reset();
                document.getElementById('version-counter').value = 1;
                document.getElementById('version-display').textContent = 1;
                
                 ['deliverables-list', 'metrics-list', 'team-list', 'milestones-list'].forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });
                addItem('deliverables-list', false);
                addItem('metrics-list', false);
                addItem('team-list', true);
                addMilestone('Phase 1: Discovery & Analysis');
                addMilestone('Phase 2: Strategy & Development');
                addMilestone('Phase 3: Implementation & Testing');

                ['mission-objective', 'background', 'in-scope', 'out-of-scope'].forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });

                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                document.getElementById('project-loader-dropdown').value = '';
            }
        }

        window.onbeforeprint = prepareForPrint;
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            addMilestone('Phase 1: Discovery & Analysis');
            addMilestone('Phase 2: Strategy & Development');
            addMilestone('Phase 3: Implementation & Testing');
            populateProjectDropdown();
            
            document.querySelectorAll('.editor').forEach(editor => {
                editor.addEventListener('focusout', () => saveSelection(editor));
                editor.addEventListener('click', () => saveSelection(editor));
                editor.addEventListener('keyup', () => saveSelection(editor));
            });
        });
    </script>

</body>
</html>
